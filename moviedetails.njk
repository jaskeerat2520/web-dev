---
layout: mylayout 
title: movies
pagination:
  
  data: movies 
  size: 1 
  alias: movie 

  

permalink: moviedetails/{{ movie.title | slug }}/index.html

---


<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card bg-light m-4">
        <div class="card-body text-center">
          <h1 class="card-title">{{ movie.title }}</h1>
          
          {% for block in movie.overview %}
            <p>{{ block.children[0].text }}</p>
          {% endfor %}
          
          <img class="img-fluid w-50 mx-auto d-block" src="https://cdn.sanity.io/images/vgsscqcj/production/{{movie.poster.asset._ref | filterImage}}" alt="Movie poster" />
          
          <h2 class="mt-3">{{movie.rating }} / 10 </h2>
        </div>
      </div>

      <div class="mt-4">
        <h2>Reviews:</h2>
        {% for review in movie.review %}
          <div class="card mb-3">
            <div class="card-body">
              <h3 class="card-title">{{ review.Title }}</h3>
              <p class="card-text">{{ review.reviewContent }}</p>
              <p class="card-text">Rating: {{ review.rating }}/10</p>
              <p class="card-text"><small class="text-muted">Date: {{ review.date }}</small></p>
            </div>
          </div>
        {% endfor %}
      </div>

      <button class="btn btn-primary mb-3" onClick="showForm()">Add a review</button>

      <form style="display: none;" id="review-form" class="mb-4">
        <div class="mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" class="form-control" id="title" name="title" placeholder="Enter title">
        </div>

        <div class="mb-3">
          <label for="review" class="form-label">Review</label>
          <textarea class="form-control" id="review" name="review" rows="4"></textarea>
        </div>

        <div class="mb-3">
          <label for="rating" class="form-label">Rating</label>
          <input type="number" class="form-control" id="rating" name="rating" placeholder="0-10" min="0" max="10">
        </div>

        <button type="button" class="btn btn-success" onClick="handleReviewSubmission()">Submit Review</button>
      </form>
    </div>
  </div>
</div>
<script>
  console.log(JSON.stringify({{ movies[0] | dump | safe }}));
function handleRatingChange(value){

  console.log(value);
}
function showForm(){

  document.getElementById('review-form').style.display = 'block'; // Makes it visible
  console.log("yes")

}
function handleReviewSubmission() {
  const form = document.getElementById('review-form');
  const formData = new FormData(form);
  const title = formData.get('title');
  const review = formData.get('review');
  const rating = formData.get('rating');

  submitReview(title, review, rating)
    .then(data => {
      console.log('Review submitted:', data);
      form.reset();
      form.style.display = 'none';
    })
    .catch(error => {
      console.error('Error submitting review:', error);
    });



}

async function submitReview(title, review, rating) {
  try {
    const response = await fetch('https://lighthearted-gecko-702685.netlify.app/.netlify/functions/review', {
     mode: 'no-cors',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title, review, rating })
    });
    const data = await response.json();
    console.log(data);
    return data;
  } catch (error) {
    console.error('Error:', error);
    throw error;
  }
}
</script>


